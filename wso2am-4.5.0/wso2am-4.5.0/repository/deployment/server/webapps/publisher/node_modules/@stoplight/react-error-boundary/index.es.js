import{createElement as r,createContext as t,PureComponent as e,createRef as o}from"react";class n extends Error{constructor(r,t){super(),this.name="GenericReactErrorBoundaryError",this.message=r.message,this.componentStack=null===t?null:t.componentStack}toJSON(){return{name:this.name,message:this.message,stack:this.stack,componentStack:this.componentStack}}}const s=()=>{window.location.reload()},a=({className:t,tryRecovering:e})=>r("div",{className:t},r("h2",null,"Gah. The component just crashed"),r("p",null,"You can try reloading component or refresh the page."),r("button",{onClick:e,type:"button"},"Reload component"),r("button",{onClick:s,type:"button"},"Refresh page")),c=t({reporter:console,FallbackComponent:a}),i=t=>{var{children:e}=t,o=function(r,t){var e={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&t.indexOf(o)<0&&(e[o]=r[o]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(r);n<o.length;n++)t.indexOf(o[n])<0&&(e[o[n]]=r[o[n]])}return e}(t,["children"]);return r(c.Provider,{value:o},e)};class l extends e{constructor(){super(...arguments),this.state={error:null,componentStack:null},this.throwError=(r=>{this.setError(r),this.handleError(r,null)}),this.recover=(()=>{null!==this.state.error&&this.setError(null)})}componentDidUpdate(r){if(null!==this.state.error&&void 0!==this.props.recoverableProps&&Array.isArray(this.props.recoverableProps))for(const t of this.props.recoverableProps)if(r[t]!==this.props[t]){this.setError(null);break}}componentDidCatch(r,t){this.setError(r,t.componentStack),this.handleError(r,t)}handleError(r,t){const e=new n(r,t);!1!==this.props.reportErrors&&this.context.reporter.error(e),"function"==typeof this.props.onError&&this.props.onError(e)}setError(r,t=null){this.setState({error:r,componentStack:t})}render(){const{props:{FallbackComponent:t=this.context.FallbackComponent||a,children:e},state:{error:o,componentStack:n}}=this;return null!==o?r(t,{error:o,componentStack:n,tryRecovering:this.recover}):e}}l.contextType=c;const p=(t,e)=>{const n=n=>{const s=o();return r(l,Object.assign(Object.assign(Object.assign({},e),n),{ref:s}),r(t,Object.assign(Object.assign({},n),{boundaryRef:s})))},s=t.displayName||t.name;return n.displayName=s?`WithErrorBoundary(${s})`:"WithErrorBoundary",n};export{l as ErrorBoundary,c as ErrorBoundaryContext,i as ErrorBoundaryProvider,a as FallbackComponent,p as withErrorBoundary};
